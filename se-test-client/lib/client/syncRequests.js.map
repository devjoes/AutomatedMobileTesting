{"version":3,"sources":["../../src/client/syncRequests.js"],"names":["syncRequests","data","intervalMs","Promise","config","seleniumUrl","headers","seleniumHeaders","catch","console","warn","finally","setTimeout","then","r","json","queueLengths","Object","keys","emulators","reduce","acc","i","j","forEach","udid","undefined","updateQueueLengths","res"],"mappings":"2EAAA,uC;AACA,mC;;AAEA,IAAMA,eAAe,SAAfA,YAAe,CAACC,IAAD,EAAOC,UAAP,UAAsB,IAAIC,OAAJ,CAAY;AAC/C,qCAAMC,iBAAOC,WAAP,GAAqB,8BAA3B,EAA2D;AACvDC,yBAASF,iBAAOG,eADuC,EAA3D;;AAGCC,iBAHD,CAGOC,QAAQC,IAHf;AAICC,mBAJD,CAIS,oBAAMC,WAAW,oBAAMZ,aAAaC,IAAb,EAAmBC,UAAnB,CAAN,EAAX,EAAiDA,UAAjD,CAAN,EAJT;AAKCW,gBALD,CAKM,qBAAKC,EAAEC,IAAF,EAAL,EALN;AAMCF,gBAND,CAMM,aAAK;AACP,oBAAMG,eAAeC,OAAOC,IAAP,CAAYjB,KAAKkB,SAAjB,EAA4BC,MAA5B,CAAmC,UAACC,GAAD,EAAMC,CAAN,EAAY;AAChED,wBAAIC,CAAJ,IAAS,CAAT;AACA,2BAAOD,GAAP;AACH,iBAHoB,EAGlB,EAHkB,CAArB;AAIAE,kBAAE,wBAAF,EAA4BC,OAA5B,CAAoC,aAAK;AACrC,wBAAIR,aAAaM,EAAEG,IAAf,MAAyBC,SAA7B,EAAwC;AACpCV,qCAAaM,EAAEG,IAAf;AACH;AACJ,iBAJD;AAKA;AACAxB,qBAAK0B,kBAAL,CAAwBX,YAAxB;AACAY;AACH,aAnBD,CAD+C,GAAZ,CAAtB,EAArB,C;;AAsBe5B,Y;;AAEf","file":"syncRequests.js","sourcesContent":["import fetch from 'node-fetch';\r\nimport config from '../config';\r\n\r\nconst syncRequests = (data, intervalMs) => new Promise(res =>\r\n        fetch(config.seleniumUrl + '/grid/admin/Console/requests', {\r\n            headers: config.seleniumHeaders\r\n        })\r\n        .catch(console.warn)\r\n        .finally(() => setTimeout(() => syncRequests(data, intervalMs), intervalMs))\r\n        .then(r => r.json())\r\n        .then(j => {\r\n            const queueLengths = Object.keys(data.emulators).reduce((acc, i) => {\r\n                acc[i] = 0;\r\n                return acc;\r\n            }, {});\r\n            j['requested_capabilities'].forEach(i => {\r\n                if (queueLengths[i.udid] !== undefined) {\r\n                    queueLengths[i.udid]++;\r\n                }\r\n            });\r\n            //console.log(queueLengths)\r\n            data.updateQueueLengths(queueLengths);\r\n            res();\r\n        }));\r\n\r\nexport default syncRequests;\r\n\r\n/*\r\n{\r\n    \"requested_capabilities\": [\r\n        {\r\n        \"app\": \"/apps/app.apk\",\r\n        \"browserName\": \"android\",\r\n        \"browserVersion\": \"node-droid722700001J\",\r\n        \"deviceName\": \"android\",\r\n        \"newSessionWaitTimeout\": 60000,\r\n        \"platformName\": \"android\",\r\n        \"platformVersion\": \"4.2.2\",\r\n        \"udid\": \"droid722700001J_2:5555\"\r\n        }\r\n    ]\r\n}\r\n*/"]}